# Remote-control-amplifier
ИК управление усилителем мощности

Селектор входов для УМЗЧ версия dav 2014 v1.2

Изменения в версиях:
  v1.1 - добавлена поддержка включения усилителя тыловых колонок вместо Source5
       - изменена установка auto off
  v1.2 - теперь во время мигания светодиодов(только Source)  команды пульта обрабатываются
       - новая команда пульта - возврат в предыдущий source
       - команды пульта можно продублировать на втором пульте, т.е. на каждую функцию 2 кнопки пульта
       - вместо импульсов громкости можно формировать постоянный сигнал
       - подправлены задержки
       - обновлен алгоритм кодирования

Селектор работает следующим образом:

для обучения пульта ДУ (любой фирмы и модели теоретически должен работать)
необходимо:
1.Нажать кнопку "Source Select" и не отпуская ее подать питание на микроконтроллер.
2.Затем должен замигать светодиод "Source1", далее непрерывное свечение.
3."Source Select" отпустить.
4.Нажать на пульте кнопку для подключения источника1 к усилителю.
5.Затем включатся все светодиоды Source 1-5 и AufoOFF и On/Standby.(это означает запись кода пульта в память микроконтроллера)
6.Затем все светодиоды отключатся, и включится светодиод "Source2".
  Далее методика аналогична, программируется Source3,Source4,Source5.
7.Затем включатся светодиоды Source1,3,5  - программируется функция  return(возврат в предыдущий source) 
8 Далее аналогично п.6  программируется функции "On/Standby", затем "Aoff", затем "Mute"
9.Следующие функции не имеют светодиодов, но программирование функции продолжается после программирования "Mute". Никакие светодиоды включены не будут. Необходимо нажать на пульте ДУ кнопку функции Source Select (аналогично кнопке на схеме).
10. Далее аналогично программируется функция Громкость увеличить, и Громкость уменьшить
11. Затем будут мигать все светодиоды, после этого начинается повторное программирование аналогично с п.1 (запись идет в другую область памяти для дублирования команд)
    если вам не нужно дублирование, то можно выключать питание.
12. В завершении программирования все Светодиоды включатся и будут непрерывно светится. Можно выключать питание.
13. Если вам какая-то функция не нужна, то в момент ожидания команды с пульта нажмите кнопку "On/Standby" (на схеме) и запись в память будет пропущена, хотя светодиоды по прежнему будут все включатся.
14. Для Очистки Памяти от всех кодов пультов необходимо, при выключенном питании нажать кнопки (согласно схеме) "Source Select" и "AutoOFf" и включить питание. Кнопки можно отжать.
Каждая команда будет стираться, и соответственно будут мигать все светодиоды одновременно. Когда очистка закончится, все светодиоды включатся и будут непрерывно светится. Можно выключать питание.

-- Инструкция пользователя для эксплуатации --
1. Предполагается что питание на микроконтроллер подано постоянно (режим StandBy)
2. Включение УMЗЧ - нажать кнопку "On/Standby" - включится светодиод "On/Standby". Включится "реле включения усилителя". Включится последний использовавшийся Source(источник). Затем включится реле "подключения колонок к усилителю".
3. Выключение УМЗЧ- нажать кнопку "On/Standby". Отключится реле "подключения колонок к усилителю". Затем все остальное.
4. Если во включенном режиме нажать кнопку "Mute" - отключится реле "подключения колонок к усилителю". Для обратного включения снова нажать кнопку "Mute".
5. Если во включенном режиме нажать кнопку "AutoOFF" включится соотв. светодиод и начнется обратный отсчет времени выключения.
   При нажатии кнопки "AutoOFF", светодиод "AutoOFF" помигает(3 раза) и засветится непрерывно, время отключения будет 2 часа.
   При повторном нажатии кнопки "AutoOFF", время отключения будет 1 час(помигает 2 раза). Если снова нажать, то время отключения будет 30минут(помигает 1 раз) . 
   Очередное нажатие отменит автоотключение. Светодиод отключится.
6. При нажатии Громкость должен формироваться соотв. Импульс 100мкс( сделал, но не проверял)
7. Кнопка "Source Select" последовательно коммутирует входы c 1 по 5.
   Или через пульт ДУ можно сразу выбирать нужный вход. Коммутация входов осуществляется через отключение реле колонок(для исключения щелчков в акустике)
8. Если вам не нужен Source5, можно использовать выход(Source5) для независимого его вкл/выкл (например включения усилителя тыловых колонок).
   Для этого при подаче питания на микроконтроллер необходимо удерживать кнопку "Mute". Загорятся светодиоды(при установке режима с 4 source будет включаться только светодиод Source5). 
   Питание можно выключить. После этого количество Source будет 4. Реле Source5 можно вкл. или выкл. соотв. кнопкой с пульта.
9. При повторном включении питания с нажатой кнопкой "Mute"(включатся светодиоды Source 3,4,5) изменится режим работы громкость - вместо импульсов на выходах, будет формироваться постоянный сигнал. (этот режим 
    можно использовать для включения внешних реле, даже не связанных с громкостью).
10.При очередном включении питания с нажатой кнопкой "Mute"(включатся светодиоды Source 3,4). Снова будет режим с пятью Source. п.9 будет в силе.
11.При очередном включении питания с нажатой кнопкой "Mute"(включатся все светодиоды). Снова включится режим громкостм с импульсами на выходе.



-- Инструкция пользователя у кого не работает пульт --
1. Вместо кнопок на выводы 2,3 микроконтроллера подключить преобразователь (RS-232 - Rx-Tx) подключить
к COM порту, запустить Терминал (я использовал Extem v1.2). параметры связи 9600, bit 8, patit NONE,stopbit 0.
2. Нажать кнопку "On/Standby" и не отпуская подать питание на микроконтроллер. Затем отпустить кнопку.
3. С терминала послать символ "1". В ответ микроконтроллер должен прислать сообщения со словом "Ready"
4. Затем можно нажать кнопку на пульте ДУ и в терминале отобразится информация для анализа(почему ваш пульт не работает)
возможно, нужно подкорректировать алгоритм.
5. Если c терминала послать символ "e", то в ответ придет инфа содержимое EEPROM
6. Еще есть команда "0", включится краткий режим, анализа команд пульта.
Пульты с дисплеем могут не работать, т.к. у них возможно, что на каждой кнопке формируется постоянно меняющийся код.
